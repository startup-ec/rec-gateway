# ===============================================
# CONFIGURACIÓN BASE DEL SERVIDOR (RAILWAY)
# ===============================================
server:
  port: ${PORT:8080}

spring:
  application:
    name: rec-gateway

  cloud:
    gateway:
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin

      server:
        webflux:
          globalcors:
            cors-configurations:
              "[/**]":
                allowedOrigins:
                  - "https://kbastidz.github.io"
                  - "https://rec-gateway.up.railway.app"
                allowedMethods: "*"
                allowedHeaders: "*"
                allowCredentials: true

          httpclient:
            connect-timeout: 5000
            response-timeout: 30s
            pool:
              max-connections: 100

# ===============================================
# CONFIGURACIÓN JWT (VARIABLES DE ENTORNO)
# ===============================================
cognito:
  jwt:
    secret: ${COGNITO_JWT_SECRET}
    expiration: ${COGNITO_JWT_EXPIRATION:86400000}

# ===============================================
# GATEWAY - SERVICIOS (CLOUD)
# ===============================================
gateway:
  services:

    notification-service:
      name: notification-service
      url: ${NOTIFICATION_SERVICE_URL}
      requires-auth: false

    rec-cognito:
      name: rec-cognito
      url: ${REC_COGNITO_URL}
      requires-auth: false

    rec-leaf-scan-cacao:
      name: rec-leaf-scan-cacao
      url: ${REC_LEAF_SCAN_CACAO_URL}
      requires-auth: true

    rec-gamificacion:
      name: rec-gamificacion
      url: ${REC_GAMIFICACION_URL}
      requires-auth: true

    rec-educacion:
      name: rec-educacion
      url: ${REC_EDUCACION_URL}
      requires-auth: true

# ===============================================
# HEALTH / METRICS
# ===============================================
management:
  endpoint:
    health:
      show-details: always
  endpoints:
    web:
      exposure:
        include: health,info,metrics,gateway,routes

# ===============================================
# LOGGING
# ===============================================
logging:
  level:
    org.springframework.cloud.gateway: INFO
    com.api.gateway: INFO
    root: INFO
